"use strict";(self.webpackChunkdev_blink_sv=self.webpackChunkdev_blink_sv||[]).push([[9106],{5818:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>l});var i=t(4848),a=t(8453);const o={id:"oauth2",title:"OAuth2 integration",slug:"/api/oauth2"},s="OAuth2 integration guide",r={id:"api/oauth2",title:"OAuth2 integration",description:"The OAuth2 integration in Blink empowers third-party applications to authenticate and interact with the Blink backend services seamlessly. By leveraging Ory Hydra, an OAuth 2.0 and OpenID Connect server, applications can obtain secure access to the Blink API, enabling functionalities such as data access and transaction management within the Blink ecosystem.",source:"@site/docs/api/oauth2.md",sourceDirName:"api",slug:"/api/oauth2",permalink:"/api/oauth2",draft:!1,unlisted:!1,editUrl:"https://github.com/GaloyMoney/dev.blink.sv/edit/main/docs/api/oauth2.md",tags:[],version:"current",frontMatter:{id:"oauth2",title:"OAuth2 integration",slug:"/api/oauth2"},sidebar:"apiSidebar",previous:{title:"Websocket connection",permalink:"/api/websocket"},next:{title:"Proof of payment",permalink:"/api/proof-of-payment"}},c={},l=[{value:"Getting started",id:"getting-started",level:2},{value:"Register your application",id:"register-your-application",level:2},{value:"Application approval",id:"application-approval",level:3},{value:"Callback URL",id:"callback-url",level:3},{value:"Oauth2 authorization token",id:"oauth2-authorization-token",level:3},{value:"Client ID and secret",id:"client-id-and-secret",level:3},{value:"Configuration examples",id:"configuration-examples",level:2},{value:"Blink Dashboard",id:"blink-dashboard",level:3},{value:"Blink PoS",id:"blink-pos",level:3},{value:"Implementing OAuth2 in your application",id:"implementing-oauth2-in-your-application",level:2},{value:"Using the Oauth2-Token header",id:"using-the-oauth2-token-header",level:3},{value:"Example using next-auth in the Blink PoS",id:"example-using-next-auth-in-the-blink-pos",level:3}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"oauth2-integration-guide",children:"OAuth2 integration guide"}),"\n",(0,i.jsxs)(n.p,{children:["The OAuth2 integration in Blink empowers third-party applications to authenticate and interact with the Blink backend services seamlessly. By leveraging ",(0,i.jsx)(n.a,{href:"https://github.com/ory/hydra",children:"Ory Hydra"}),", an OAuth 2.0 and OpenID Connect server, applications can obtain secure access to the Blink API, enabling functionalities such as data access and transaction management within the Blink ecosystem."]}),"\n",(0,i.jsx)(n.h2,{id:"getting-started",children:"Getting started"}),"\n",(0,i.jsxs)(n.p,{children:["Before integrating with Blink OAuth2, it's crucial to have a foundational understanding of ",(0,i.jsx)(n.a,{href:"https://www.ory.sh/docs/oauth2-oidc/overview/oauth2-concepts",children:"OAuth 2.0"})," and ",(0,i.jsx)(n.a,{href:"https://www.ory.sh/docs/oauth2-oidc/overview/oidc-concepts",children:"OpenID Connect (OIDC)"}),". These protocols facilitate secure authorization workflows between your application and Blink services, allowing for authenticated access to user-specific data and actions.\nThe connecting applications are using the ",(0,i.jsx)(n.a,{href:"https://www.ory.sh/docs/oauth2-oidc/authorization-code-flow",children:"OAuth2 authorization code flow"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"register-your-application",children:"Register your application"}),"\n",(0,i.jsx)(n.p,{children:"To initiate the integration process, your application must be registered and approved by Blink's development team. This is a critical step to ensure secure and authorized access to Blink's API functionalities."}),"\n",(0,i.jsx)(n.h3,{id:"application-approval",children:"Application approval"}),"\n",(0,i.jsxs)(n.p,{children:["Reach out to the Blink development team via our Mattermost server at ",(0,i.jsx)(n.a,{href:"https://chat.galoy.io",children:"chat.galoy.io"})," to start the approval process for using OAuth2. You'll need to provide details about your application, including its purpose and the scopes of access required."]}),"\n",(0,i.jsx)(n.h3,{id:"callback-url",children:"Callback URL"}),"\n",(0,i.jsx)(n.p,{children:"Specify the callback URL for your application. This URL is where users will be redirected after successful authentication, facilitating the completion of the OAuth2 flow."}),"\n",(0,i.jsx)(n.h3,{id:"oauth2-authorization-token",children:"Oauth2 authorization token"}),"\n",(0,i.jsxs)(n.p,{children:["After the approval you will be provided an Oauth2 authorization token which will be needed in the ",(0,i.jsx)(n.a,{href:"#using-the-oauth2-token-header",children:"Oauth2-Token header"})]}),"\n",(0,i.jsx)(n.h3,{id:"client-id-and-secret",children:"Client ID and secret"}),"\n",(0,i.jsx)(n.p,{children:"After the registration you will receive a client ID and a client secret from our server. These are unique identifiers that allow the Blink API backend to identify your application and allow it to access protected resources. The client ID is considered public information and can be included in JavaScript source code or used to build login URLs. The client secret, however, must be kept confidential and is used to authenticate the client to the authorization server."}),"\n",(0,i.jsx)(n.h2,{id:"configuration-examples",children:"Configuration examples"}),"\n",(0,i.jsxs)(n.p,{children:["Below are the Terraform configurations for two existing Blink integrations, showcasing how to set up OAuth2 clients for different applications using the ",(0,i.jsx)(n.a,{href:"https://registry.terraform.io/providers/svrakitin/hydra/latest/docs/resources/oauth2_client",children:"hydra_oauth2_client Terraform resource"})," :"]}),"\n",(0,i.jsx)(n.h3,{id:"blink-dashboard",children:"Blink Dashboard"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["try it at ",(0,i.jsx)(n.a,{href:"https://dashboard.blink.sv",children:"dashboard.blink.sv"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'resource "hydra_oauth2_client" "api_dashboard" {\n  client_name                = "Blink Api Dashboard"\n  grant_types                = ["authorization_code"]\n  response_types             = ["code", "id_token"]\n  token_endpoint_auth_method = "client_secret_basic"\n  scopes                     = ["read", "write"]\n  redirect_uris              = [local.api_dashboard_hydra_redirect_uri]\n  skip_consent               = true\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"blink-pos",children:"Blink PoS"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["try it at ",(0,i.jsx)(n.a,{href:"https://pay.blink.sv",children:"pay.blink.sv"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'resource "hydra_oauth2_client" "galoy_pay" {\n  client_name                = "Blink POS"\n  grant_types                = ["authorization_code"]\n  response_types             = ["code", "id_token"]\n  token_endpoint_auth_method = "client_secret_basic"\n  scopes                     = ["read"]\n  redirect_uris              = [for host in local.galoy_pay_hosts : "https://${host}/api/auth/callback/blink"]\n  skip_consent               = true\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"implementing-oauth2-in-your-application",children:"Implementing OAuth2 in your application"}),"\n",(0,i.jsx)(n.p,{children:"After your application is approved, you'll need to implement the OAuth2 flow. This involves setting up your application to redirect users to the Blink authentication service, handle the redirect back with an authorization code, and exchange that code for an access token."}),"\n",(0,i.jsxs)(n.p,{children:["For a hands-on introduction to setting up OAuth2 with Ory Hydra, you can explore this ",(0,i.jsx)(n.a,{href:"https://www.ory.sh/docs/hydra/5min-tutorial",children:"5-minute tutorial"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"using-the-oauth2-token-header",children:"Using the Oauth2-Token header"}),"\n",(0,i.jsxs)(n.p,{children:["Note that the Oauth2 token needs a different header for Authentication (compared to API keys using the ",(0,i.jsx)(n.code,{children:"X-API-KEY"})," header or the authentication token used in the Blink mobile app).\nExample header for the Blink PoS:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'      headers: {\n        ...(options?.token ? { ["Oauth2-Token"]: options.token } : {}),\n      },\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Link to the ",(0,i.jsx)(n.a,{href:"https://github.com/GaloyMoney/blink/pull/4149/files#diff-d5101fe657d3e5befe3ec31871012666597b3f346292241dffde4938c625090dR21",children:"code with the context"}),"."]}),"\n",(0,i.jsxs)(n.h3,{id:"example-using-next-auth-in-the-blink-pos",children:["Example using ",(0,i.jsx)(n.a,{href:"https://www.npmjs.com/package/next-auth",children:"next-auth"})," in the Blink PoS"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'export const authOptions: NextAuthOptions = {\n  providers: [\n    {\n      id: "blink",\n      clientId: env.CLIENT_ID,\n      clientSecret: env.CLIENT_SECRET,\n      wellKnown: `${env.HYDRA_PUBLIC}/.well-known/openid-configuration`,\n      authorization: {\n        params: { scope: "read" },\n      },\n      idToken: false,\n      name: "Blink",\n      type,\n      profile(profile) {\n        return {\n          id: profile.sub,\n        }\n      },\n    },\n  ],\n  debug: process.env.NODE_ENV === "development",\n  secret: env.NEXTAUTH_SECRET,\n  callbacks: {\n    async jwt({ token, account, profile }) {\n      if (account) {\n        token.accessToken = account.access_token\n        token.expiresAt = account.expires_at\n        token.refreshToken = account.refresh_token\n        token.id = profile?.id\n      }\n      return token\n    },\n    async session({ session, token }) {\n      if (\n        !token.accessToken ||\n        !token.sub ||\n        typeof token.accessToken !== "string" ||\n        typeof token.sub !== "string"\n      ) {\n        throw new Error("Invalid token")\n      }\n      const res = await fetchUserData({ token: token.accessToken })\n\n      if (!(res instanceof Error)) {\n        session.userData = res.data\n      }\n      session.sub = token.sub\n      session.accessToken = token.accessToken\n      return session\n    },\n  },\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Link to the ",(0,i.jsx)(n.a,{href:"https://github.com/GaloyMoney/blink/pull/4149/files#diff-224eae5be0d335d0d64941907106c189977dc51b2a0139459083b777efddf953R19-R70",children:"code with the context"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:["If you encounter any challenges or have questions during the integration process, don't hesitate to reach out to the Blink development team for assistance at our Mattermost server at ",(0,i.jsx)(n.a,{href:"https://chat.galoy.io",children:"chat.galoy.io"}),"."]})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>r});var i=t(6540);const a={},o=i.createContext(a);function s(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);