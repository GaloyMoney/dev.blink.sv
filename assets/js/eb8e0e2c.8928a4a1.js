"use strict";(self.webpackChunkdev_blink_sv=self.webpackChunkdev_blink_sv||[]).push([[264],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>d});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),s=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=s(e.components);return a.createElement(l.Provider,{value:t},e.children)},h="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},f=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),h=s(n),f=r,d=h["".concat(l,".").concat(f)]||h[f]||m[f]||i;return n?a.createElement(d,o(o({ref:t},c),{},{components:n})):a.createElement(d,o({ref:t},c))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=f;var p={};for(var l in t)hasOwnProperty.call(t,l)&&(p[l]=t[l]);p.originalType=e,p[h]="string"==typeof e?e:r,o[1]=p;for(var s=2;s<i;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}f.displayName="MDXCreateElement"},5144:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>p,toc:()=>s});var a=n(7462),r=(n(7294),n(3905));const i={id:"proof-of-payment",title:"Proof of payment",slug:"/api/proof-of-payment"},o="Proof of Payment in Lightning",p={unversionedId:"api/proof-of-payment",id:"api/proof-of-payment",title:"Proof of payment",description:"When using the Lightning Network the data is not recorded on the Bitcoin blockchain, but still there is a cryptographic proof of payment consisting of:",source:"@site/docs/api/proof-of-payment.md",sourceDirName:"api",slug:"/api/proof-of-payment",permalink:"/api/proof-of-payment",draft:!1,tags:[],version:"current",frontMatter:{id:"proof-of-payment",title:"Proof of payment",slug:"/api/proof-of-payment"},sidebar:"apiSidebar",previous:{title:"Websocket connection",permalink:"/api/websocket"},next:{title:"Error handling",permalink:"/api/errors"}},l={},s=[{value:"List invoices with proof of payment",id:"list-invoices-with-proof-of-payment",level:2},{value:"Variable to show the two most recent transactions",id:"variable-to-show-the-two-most-recent-transactions",level:3},{value:"Sample response showing the invoice, payment hash and pre-image",id:"sample-response-showing-the-invoice-payment-hash-and-pre-image",level:3},{value:"Verify the proof of payment",id:"verify-the-proof-of-payment",level:2},{value:"Decode the invoice",id:"decode-the-invoice",level:3},{value:"Verify the pre-image",id:"verify-the-pre-image",level:3}],c={toc:s},h="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(h,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"proof-of-payment-in-lightning"},"Proof of Payment in Lightning"),(0,r.kt)("p",null,"When using the Lightning Network the data is not recorded on the Bitcoin blockchain, but still there is a cryptographic proof of payment consisting of:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"the ",(0,r.kt)("strong",{parentName:"li"},"lightning invoice")," - contents signed by the recipient node"),(0,r.kt)("li",{parentName:"ul"},"the ",(0,r.kt)("strong",{parentName:"li"},"pre-image")," - which the payer only receives when the invoice is paid.")),(0,r.kt)("p",null,"See the Blink FAQ answers for more general details:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://faq.blink.sv/blink-and-other-wallets/how-to-prove-that-a-lightning-invoice-was-paid"},"How to prove that a lightning invoice was paid?")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://faq.blink.sv/using-blink/how-to-obtain-a-proof-of-payment-from-blink"},"How to obtain a Proof of Payment from Blink?"))),(0,r.kt)("h2",{id:"list-invoices-with-proof-of-payment"},"List invoices with proof of payment"),(0,r.kt)("p",null,"Requests the two most recent transactions paid via a lightning invoice (could settle over the lightning network or internally)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-graphql"},"query PaymentsWithProof($first: Int) {\n  me {\n    defaultAccount {\n      transactions(first: $first) {\n        edges {\n          node {\n            initiationVia {\n              ... on InitiationViaLn {\n                paymentRequest\n                paymentHash\n              }\n            }\n            settlementVia {\n              ... on SettlementViaIntraLedger {\n                preImage\n              }\n              ... on SettlementViaLn {\n                preImage\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n")),(0,r.kt)("h3",{id:"variable-to-show-the-two-most-recent-transactions"},"Variable to show the two most recent transactions"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "first": 2\n}\n')),(0,r.kt)("h3",{id:"sample-response-showing-the-invoice-payment-hash-and-pre-image"},"Sample response showing the invoice, payment hash and pre-image"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "data": {\n    "me": {\n      "defaultAccount": {\n        "transactions": {\n          "edges": [\n            {\n              "node": {\n                "initiationVia": {\n                  "paymentRequest": "lntbs320n1pjehuh8pp5cf6ckqv265qu6ppul0mhv4qpw4zkmd6rcxx080f8cqaz3w5p5m2qhp5ermsf933ju2t2vzpehcndlf8kpjqa780h6kzaa5eevpq6s8a7t9qcqzpuxqyz5vqsp5xs2v586kum4lu7exwskukkf0wjyw29l50293c8scdetlvszdgdds9qyyssqgzxzle9hz6384qt8uzh74wy3ylp6g3yw74q06zelxuhxtgwk9ehxvgtmqh53furqceecm22jsv2aypcangdn2tayl0vl095qx0wh3hqpwrfl8j",\n                  "paymentHash": "c2758b018ad501cd043cfbf776540175456db743c18cf3bd27c03a28ba81a6d4"\n                },\n                "settlementVia": {\n                  "preImage": "9e92a2d24e89c92c93d2c63ffe126605bcd3bf614c727a1f6e3f52064b83c2ec"\n                }\n              }\n            },\n            {\n              "node": {\n                "initiationVia": {\n                  "paymentRequest": "lntbs10n1pjehukhpp57ngk3ddxtmytqdzcyqa4l2e87ny29rwjsqx46g6m0pvpj7tvp6vshp5at629lcgdgt53gsapw77s59ykxxn7lkxyfk4n7zdx78c65s9502scqzpuxqyz5vqsp5nru4r9hu7asuvn86euyuskzdppl3lt4xue5wl8jxawaxc5rmzynq9qyyssq4c0d6lmszx6udlw8elv6dcawlsu7069fqd60wc4xxc3v6h5lmag45f8ks9lrdwnajysc0ka3lmgchfwrjjlgx4a8dg8g7gjlqaezecgqn706p3",\n                  "paymentHash": "f4d168b5a65ec8b03458203b5fab27f4c8a28dd2800d5d235b785819796c0e99"\n                },\n                "settlementVia": {\n                  "preImage": "f3a2290961be4b91bb230cfe7ae9d8159667dd9da33ca95b7c609bf82034285c"\n                }\n              }\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n')),(0,r.kt)("h2",{id:"verify-the-proof-of-payment"},"Verify the proof of payment"),(0,r.kt)("h3",{id:"decode-the-invoice"},"Decode the invoice"),(0,r.kt)("p",null,"The invoice can be used to identify the destination node, obtain the payment hash and analyze other contents by decoding it for example in:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://dev.blink.sv/decode"},"dev.blink.sv/decode")," which uses the ",(0,r.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/bolt11"},"bolt11 nodejs package")," in the browser"),(0,r.kt)("li",{parentName:"ul"},"using LND:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ lncli decodepayreq <invoice>\n"))),(0,r.kt)("li",{parentName:"ul"},"or CLN",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ lightning-cli decode <invoice>\n")))),(0,r.kt)("h3",{id:"verify-the-pre-image"},"Verify the pre-image"),(0,r.kt)("p",null,"The payment hash is the sha256 hash of the binary form of the preimage which can be verified in:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://dev.blink.sv/decode"},"dev.blink.sv/decode"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"or in linux terminal:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ echo -n '<preimage_in_hex>'| xxd -r -p | sha256sum\n")))),(0,r.kt)("p",null,"To use the preimage as a proof of payment the calculated hash must match the payment hash in the invoice."),(0,r.kt)("hr",null),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"To test the GraphQL requests further use the GraphQL playground at ",(0,r.kt)("a",{parentName:"p",href:"https://api.blink.sv/graphql"},"api.blink.sv/graphql")," for mainnet or ",(0,r.kt)("a",{parentName:"p",href:"https://api.staging.galoy.io/graphql"},"api.staging.galoy.io/graphql")," for staging.",(0,r.kt)("br",null),"\nCheck out the ",(0,r.kt)("a",{parentName:"p",href:"https://documenter.getpostman.com/view/29391384/2s9YCAQq3z#ae685bc1-d637-48b2-8e32-4600eefc9a4e"},"Galoy API Postman collection")," to find examples in multiple programming languages.")))}m.isMDXComponent=!0}}]);